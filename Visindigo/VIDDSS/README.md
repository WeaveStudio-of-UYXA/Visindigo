# Distributed Data Synchronization System
分布式数据同步系统是一个用来缓解中央服务器流量压力和流量成本的用于数据更新的分布式系统。它可以在一批文件被分发到某几个客户端后，另其他客户端从这些客户端获取文件，而不是从中央服务器获取。这样可以减轻中央服务器的流量压力，并提高数据更新的速度。

## 中央服务器数据
1. 文件，包括文件的最新版本和文件的哈希值（MD5）
2. 在线客户端列表，主要是持有最新版本文件的客户端列表
   
## 客户端逻辑
1. 客户端在启动之后，根据检查更新的时间频次决定是否检查更新，若需要更新，向中央服务器请求所有文件的哈希值
2. 客户端比较哈希差异，并从同步系统中同步文件。完全同步后，客户端将向中央服务器发送一个通知，告知此客户端有全部文件的最新版本

## 同步系统（中央服务器和客户端综合逻辑）
1. 任何请求MD5的需求均由中央服务器直接满足
2. 当有客户端请求文件的时候，同步系统从拥有最新文件的在线客户端列表中随机选择一个客户端，向其再次发送目标文件的MD5，若MD5相同，则要求其将这一文件传递给请求的客户端，若MD5不同，则中央服务器向下一个客户端发送请求，直到所有客户端均不满足要求，中央服务器直接将文件传递给请求的客户端。客户端收到文件后，需要再比对一次MD5，若MD5不同，则向中央服务器请求文件。

## 桥接服务器
客户端与客户端之间由于缺少公网IP，因此常常需要利用NAT穿透技术建立连接。NAT穿透由中央服务器完成，但在部分网络环境中可能会失败，此时则利用桥接服务器进行文件中转。即期缴服务器不保存任何数据，只在NAT穿透失败的情况下，将文件从一个客户端传递到另一个客户端。为了保证桥接服务器资源可以被动态挂载，桥接服务器的地址由中央服务器保存，在需要的时候由客户端向中央服务器请求。桥接服务器则可以任意部署，甚至中央服务器也可以充当桥接服务器。

使用桥接服务器，意味着还是需要承担流量成本（甚至更多），其唯一意义是减轻中央服务器的流量压力。若客户端网络桥接失败次数尚可容忍，则强烈推荐不部署桥接服务器。